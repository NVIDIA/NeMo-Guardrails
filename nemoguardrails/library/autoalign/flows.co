define subflow autoalign check input
  $input_result = execute autoalign_input_api(show_autoalign_message=True)
  if $input_result["guardrails_triggered"]
    $autoalign_input_response = $input_result['combined_response']
    bot refuse to respond
    stop

define subflow autoalign check output
  $output_result = execute autoalign_output_api(show_autoalign_message=True)
  if $output_result["guardrails_triggered"]
    bot refuse to respond
    stop
  else
    $pii_message_output = $output_result["pii_fast"]["response"]
    if $output_result["pii_fast"]["guarded"]
      $bot_message = $pii_message_output

define subflow autoalign factcheck output
  if $check_facts == True
    $check_facts = False
    $output_result = execute autoalign_factcheck_output_api
    if $output_result < 0.5
      $bot_message = $bot_message + "\nFactcheck violation in llm response has been detected by AutoAlign."


define bot inform autoalign factcheck output violation
  "Factcheck violation in llm response has been detected by AutoAlign."

define bot refuse to respond
  "I'm sorry, I can't respond to that."
